---

- name: Start Buildbot
  docker_compose:
    project_src: "{{ buildbot_home }}"
    pull: yes
    state: present
    restarted: yes
  #become: yes

# Lame workaround to avoid having to get the docker python plugin installed
# Currently requires py3, but these playbooks break with 3 (specifically on CentOS related to yum/dnf)...
- name: Start Databases
  shell: "docker-compose up -d"
  args:
    chdir: "{{ buildbot_home }}"
  #docker_compose:
  #  project_src: "{{ buildbot_home }}"
  #  pull: yes
  #  state: present
  #  restarted: yes
  #become: yes

- name: Start Autossh
  systemd:
    name: autossh
    state: restarted
    enabled: yes
    daemon_reload: yes
  become: yes
  when: "'master' not in group_names"

- name: Restart Docker
  systemd:
    name: docker
    state: restarted
    enabled: yes
    daemon_reload: yes
  become: yes
